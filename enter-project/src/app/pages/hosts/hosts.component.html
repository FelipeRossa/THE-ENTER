<div class="hosts-page">
    <div class="header">
        <input type="text" placeholder="Pesquisar por IP ou host..." [(ngModel)]="search" (input)="filterHosts()" />
        <button class="new-host-btn" (click)="modalNovoGrupo.abrirModal()">Novo Grupo</button>
    </div>

    <div class="host-list">
        <div class="table-container" *ngFor="let grupo of filteredHosts">
            <div class="group-header">
                <span class="badge" (click)="modalNovoGrupo.abrirModal(grupo)"
                    style="cursor:pointer; font-size: 1.2rem;" [ngStyle]="{ 'background-color': grupo.corExadecimal }">
                    {{ grupo.titulo }}
                </span>
                <span class="switch-container" *ngIf="grupo.titulo != 'SGD'">
                    <label class="switch" style="gap: 0.5rem;">
                        <input type="checkbox" [(ngModel)]="grupo.onOff" (click)="ligaDesligaGrupo(grupo)">
                        <span class="slider round"></span>
                    </label>
                    <button *ngIf="!grupo.hosts[0]?.padraoLinear" (click)="modalCadastroHost.abrirModal(grupo)"
                        class="btn btn-sm btn-outline-secondary">
                        Novo Host
                    </button>
                </span>
            </div>

            <table class="table">
                <thead>
                </thead>
                <tbody>
                    <tr *ngFor="let host of grupo.hosts">
                        <td class="align-items-center gap-2">
                            <div class="switch-container" (click)="$event.stopPropagation()">
                                <label class="switch" style="gap: 0.5rem;" *ngIf="!host.padraoLinear">
                                    <input type="checkbox" [checked]="host.onOff"
                                        (click)="ligaDesligaHost(host, grupo)">
                                    <span class="slider round"></span>
                                </label>

                                <i class="bi" [ngClass]="{
                                'bi-lightbulb-fill': host.onOff,
                                'bi-lightbulb': !host.onOff,
                                'lamp-on': host.onOff
                                }"></i>
                            </div>

                        </td>
                        <td>
                            <span [ngClass]="{'background-color-multiples-hosts badge':host.padraoLinear}">{{
                                host.ip}}</span>
                        </td>
                        <td style="justify-content: start; display: flex; cursor: pointer;"
                            (click)="modalCadastroHost.abrirModal(grupo, host)">{{ host.nmHost }}</td>
                        <td><span class="badge" [ngStyle]="{ 'background-color': host.corExadecimal }"
                                style="color: black;">{{ host.comentario }}</span></td>

                        <td *ngIf="grupo.titulo == 'SGD'">
                            <button (click)="$event.stopPropagation(); modalVincularHost.abrirModal(host, groupsHosts)"
                                class="btn btn-sm btn-outline-secondary">
                                Vincular a grupo
                            </button>
                        </td>

                        <td class="text-end">
                            <div>
                                <button class="btn btn-sm btn-outline-secondary" type="button"
                                    data-bs-toggle="dropdown" aria-expanded="false" >
                                    <i class="bi bi-three-dots-vertical"></i>
                                </button>

                                <ul class="dropdown-menu dropdown-menu-end ">
                                    <li>
                                        <button class="dropdown-item" (click)="pingHost(host)">
                                            <i class="bi bi-wifi me-2"></i> Ping
                                        </button>
                                    </li>
                                    <li>
                                        <button class="dropdown-item" (click)="abrirAnonimo(host.nmHost)">
                                            <i class="bi bi-incognito me-2"></i> Abrir em aba an√¥nima
                                        </button>
                                    </li> 

                                    <li>
                                        <button class="dropdown-item" (click)="abrirChrome(host.nmHost)">
                                            <i class="bi bi bi-browser-chrome me-2"></i> Abrir no chrome
                                        </button>
                                    </li> 
                                </ul>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>

<app-cadastro-grupo-host #modalNovoGrupo (grupoCriado)="criarGrupoEAdicionarHost($event)"></app-cadastro-grupo-host>

<app-cadastro-hosts #modalCadastroHost (hostSalvo)="loadHosts()"></app-cadastro-hosts>

<app-vincular-host-grupo #modalVincularHost (hostVinculado)="loadHosts()"></app-vincular-host-grupo>

<app-error-modal [modalTitleErr]="modalTitle" [mensagemErr]="mensagemErro" (onClose)="loadHosts()"
    #erroModal></app-error-modal>